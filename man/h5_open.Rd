% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/open.r
\name{h5_open}
\alias{h5_open}
\title{Create an HDF5 File Handle}
\usage{
h5_open(file)
}
\arguments{
\item{file}{Path to the HDF5 file. The file will be created if it does not
exist.}
}
\value{
An object of class \code{h5} with methods for interacting with the file.
}
\description{
Creates a file handle that provides a convenient, object-oriented interface
for interacting with and navigating a specific HDF5 file.
}
\details{
This function returns a special \code{h5} object that wraps the standard \code{h5lite}
functions. The primary benefit is that the \code{file} argument is pre-filled,
allowing for more concise and readable code when performing multiple
operations on the same file.

For example, instead of writing:

\if{html}{\out{<div class="sourceCode r">}}\preformatted{h5_write(file, "dset1", 1:10)
h5_write(file, "dset2", 2:20)
h5_ls(file)
}\if{html}{\out{</div>}}

You can create a handle and use its methods:

\if{html}{\out{<div class="sourceCode r">}}\preformatted{h5 <- h5_open("my_file.h5")
h5$write("dset1", 1:10)
h5$write("dset2", 2:20)
h5$ls()
}\if{html}{\out{</div>}}
}
\section{Pass-by-Reference Behavior}{

Unlike most R objects, the \code{h5} handle is an \strong{environment}. This means it
is passed by reference. If you assign it to another variable (e.g.,
\code{h5_alias <- h5}), both variables point to the \emph{same} handle. Modifying one
(e.g., by calling \code{h5_alias$close()}) will also affect the other.
}

\section{Interacting with the HDF5 File}{

The \code{h5} object provides several ways to interact with the HDF5 file:

\subsection{Standard \code{h5lite} Functions as Methods}{
Most \code{h5lite} functions (e.g., \code{h5_read}, \code{h5_write}, \code{h5_ls}) are
available as methods on the \code{h5} object, without the \code{h5_} prefix.
The \code{file} argument is automatically supplied.

For example, \code{h5$write("dset", data)} is equivalent to
\code{h5_write(file, "dset", data)}.

The available methods are: \code{read}, \code{read_attr}, \code{write}, \code{write_attr},
\code{class}, \code{class_attr}, \code{dim}, \code{dim_attr}, \code{exists}, \code{exists_attr},
\code{is_dataset}, \code{is_group}, \code{ls}, \code{ls_attr}, \code{str}, \code{typeof}, \code{typeof_attr},
\code{create_file}, \code{create_group}, \code{delete}, \code{delete_attr}, \code{move}.
}

\subsection{Navigation (\verb{$cd()}, \verb{$pwd()})}{
The handle maintains an internal working directory (\verb{_wd}) to simplify
path management.
\itemize{
\item{\code{h5$cd(group)}: Changes the handle's internal working directory.
This is a stateful, pass-by-reference operation. It understands absolute
paths (e.g., \code{"/new/path"}) and relative navigation (e.g., \code{"../other"}).
The target group does not need to exist.
}
\item{\code{h5$pwd()}: Returns the current working directory.}
}
When you call a method like \code{h5$read("dset")}, the handle automatically
prepends the current working directory to any relative path. If you provide
an absolute path (e.g., \code{h5$read("/path/to/dset")}), the working directory
is ignored.
}

\subsection{Subsetting with \code{[[} and \verb{[[<-}}{
The \code{h5} handle also supports \code{[[} for reading and writing, providing a
convenient, list-like syntax.
\itemize{
\item \strong{Reading Datasets/Groups:} \code{h5[["my_dataset"]]} is a shortcut for \code{h5$read("my_dataset")}.
\item \strong{Writing Datasets/Groups:} \code{h5[["my_dataset"]] <- value} is a shortcut for \code{h5$write("my_dataset", value)}.
\item \strong{Accessing Attributes:} You can access attributes by separating the object name
and attribute name with an \code{@} symbol. For example:
- \code{h5[["my_dataset@my_attribute"]]} reads an attribute.
- \code{h5[["my_dataset@my_attribute"]] <- "new value"} writes an attribute.
}
}

\subsection{Closing the Handle (\verb{$close()})}{
The \code{h5lite} package does not keep files persistently open. Each operation
opens, modifies, and closes the file. Therefore, the \code{h5$close()} method
does not perform any action on the HDF5 file itself.

Its purpose is to invalidate the handle, preventing any further operations
from being called. After \code{h5$close()} is called, any subsequent method
call (e.g., \code{h5$ls()}) will throw an error.
}
}

\examples{
file <- tempfile(fileext = ".h5")
h5 <- h5_open(file)

h5$write("a", 1:10)
h5$write("b", c("x", "y"))
h5$ls()

# --- Subsetting for Read/Write ---
h5[["c"]] <- matrix(1:4, 2)
h5[["c@units"]] <- "m/s"
print(h5[["c"]])
print(h5[["c@units"]])

# --- Navigation ---
h5$cd("/g1/g2")
h5$pwd() # "/g1/g2"
h5$write("d1", 1:5) # Writes to /g1/g2/d1
h5$cd("..")
h5$ls() # Lists 'g2'

# Write and read using subsetting
h5[["c"]] <- matrix(1:4, 2)
h5[["c@units"]] <- "m/s"
print(h5[["c"]])
print(h5[["c@units"]])


# Invalidate the handle
h5$close()
# try(h5$ls()) # This would now throw an error

unlink(file)
}
